<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>비밀번호 찾기</title>
</head>
<body>
<h1>비밀번호 찾기</h1>

<!-- 아이디 입력 후 질문 가져오는 폼 -->
<label for="userID">아이디:</label>
<input type="text" id="userID" name="userID" required>
<button type="button" onclick="fetchQuestion()">질문 확인</button><br>

<!-- 비밀번호 찾기 질문 표시 영역 -->
<div id="questionSection" style="display:none;">
  <p>질문: <span id="pwLOCK"></span></p>

  <label for="pwKey">답변:</label>
  <input type="text" id="pwKey" name="pwKey" required>
  <button type="button" onclick="fetchPassword()">비밀번호 찾기</button>
</div>

<!-- 비밀번호 출력 영역 -->
<div id="passwordSection" style="display:none;">
  <p>비밀번호: <span id="userPW"></span></p>
</div>

<!-- 에러 메시지 출력 -->
<p id="error" style="color: red;"></p>

<script>
  // 서버에서 질문을 가져오는 함수
  async function fetchQuestion() {
      const userID = document.getElementById("userID").value;
      if (!userID) {
          alert("아이디를 입력해주세요.");
          return;
      }

      try {
          const response = await fetch(`/users/getPwLOCK?userID=${userID}`);
          const data = await response.json();

          if (data.pwLOCK) {
              document.getElementById("pwLOCK").innerText = data.pwLOCK;
              document.getElementById("questionSection").style.display = "block";
              document.getElementById("error").innerText = "";
          } else {
              document.getElementById("error").innerText = "해당 아이디를 찾을 수 없습니다.";
              document.getElementById("questionSection").style.display = "none";
          }
      } catch (error) {
          console.error("Error fetching question:", error);
          document.getElementById("error").innerText = "오류가 발생했습니다. 다시 시도해 주세요.";
      }
  }

  // 서버에서 비밀번호를 가져오는 함수
  async function fetchPassword() {
      const userID = document.getElementById("userID").value;
      const pwKey = document.getElementById("pwKey").value;
      if (!pwKey) {
          alert("제시어 답변을 입력해주세요.");
          return;
      }

      try {
          const response = await fetch(`/users/getUserPW?userID=${userID}&pwKey=${pwKey}`);
          const data = await response.json();

          if (data.userPW) {
              document.getElementById("userPW").innerText = data.userPW;
              document.getElementById("passwordSection").style.display = "block";
              document.getElementById("error").innerText = "";
          } else {
              document.getElementById("error").innerText = "제시어가 올바르지 않습니다.";
              document.getElementById("passwordSection").style.display = "none";
          }
      } catch (error) {
          console.error("Error fetching password:", error);
          document.getElementById("error").innerText = "오류가 발생했습니다. 다시 시도해 주세요.";
      }
  }
</script>
</body>
</html>
