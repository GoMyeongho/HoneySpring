<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">게시글</title>
    <link rel="stylesheet" th:href="@{/css/gpt.css}">
</head>
<body class="container">

<script>
    window.onload = function() {
        const postUpdate = /*[[${updateSuccess}]]*/ 0; // 모델에서 상태 정보 가져오기
        if(postUpdate!==0){
            if (postUpdate) alert('글이 수정 되었습니다.');
            else alert('글 수정에 실패하였습니다')
        }
        const commDelete = /*[[${deleteCommSuccess}]]*/ 0;
        if(commDelete!==0){
            if (commDelete) alert('댓글이 삭제 되었습니다.');
            else alert('댓글 삭제에 실패하였습니다')
        }
        const commUpdate = /*[[${updateCommSuccess}]]*/ 0;
        if(commUpdate!==0){
            if (commUpdate) alert('댓글이 수정 되었습니다.');
            else alert('댓글 수정에 실패하였습니다')
        }
        const commCreate = /*[[${createCommSuccess}]]*/ 0;
        if(commCreate!==0){
            if (commCreate) alert('댓글이 생성 되었습니다.');
            else alert('댓글 생성에 실패하였습니다')
        }
        const like = /*[[${likeSuccess}]]*/ 0;
        if(like!==0){
            if (like) alert('좋아요가 수정 되었습니다.');
            else alert('좋아요 수정에 실패하였습니다')
        }
    };
</script>

<div th:class="head">
    <a th:href="@{/posts/board}">
        <img th:src="@{/image/honey.png}" alt="메인" class="icon">
    </a>
    <span>
      <table th:class="mypage-table">
          <thead th:class="mypage-head">
          <tr th:class="mypage-name">
              <!-- isUser가 true일 때는 닉네임 표시, false일 때는 "로그인이 안되어 있습니다" 메시지 표시 -->
              <th th:if="${isUser}" th:text="${user.NName}"></th>
              <th th:unless="${isUser}" class="no-login">로그인이 안되어 있습니다</th>
          </tr>
          </thead>
          <tbody>
          <tr th:class="mypage-select">
              <!-- isUser가 true일 때 마이페이지와 내정보수정 링크 표시 -->
              <td th:if="${isUser}" th:class="mypage-select">
                  <a th:href="@{/users/select}">마이페이지</a>
                  <a th:href="@{/users/update}">내정보수정</a>
              </td>
              <!-- isUser가 false일 때 로그인과 회원가입 링크 표시 -->
              <td th:unless="${isUser}" th:class="mypage-select">
                  <a th:href="@{/users/login}">로그인하기</a>
                  <a th:href="@{/login/signUp}">회원가입</a>
              </td>
          </tr>
          </tbody>
      </table>
    </span>
</div>
    <div>
        <div th:each="category : ${categories}" style="display: inline-block; margin-right: 10px;">
            <a th:href="@{/posts/board(value=${category}, type='type3')}" class="button">
                <span th:text="${category}"></span>
            </a>
        </div>
    </div>
<div class="post">
    <h2>
        <span class="postTitle" th:text="${post.title}">게시글 제목</span>
        <span class="category" th:text="' [' + ${post.category} + ']'">[카테고리]</span>
        <span class="author" th:text="'[작성자: ' + ${post.author} + ']'">작성자</span>
        <span class="date" th:text="${#dates.format(post.date, 'yyyy년 MM월 dd일')}">작성일</span>
    </h2>
    <div class="content" th:text="${post.content}">게시글 내용</div>
    <div class="like">
        <form th:if="${isUser}" th:action="@{/posts/view(postno=${post.postno})}" method="post">
            <button type="submit" class="like" th:text="${likeMark}">좋아요 <span th:text="${likeNo}">0</span></button>
        </form>
        <p th:unless="${isUser}" class="like" th:text="${likeMark}">좋아요 <span th:text="${likeNo}">0</span></p>
    </div>
</div>

<div class="comments" th:each="comment : ${cList}">
    <h3>
        <span th:text="${comment.NName} ">작성자 </span>
        <span th:text="${#dates.format(comment.CDate, 'yyyy년 MM월 dd일')}">작성일</span>
    </h3>
    <div class="button" th:if="${isUser}">
        <a th:href="@{/posts/comment/create(commType='type2')}">댓글 생성</a>

        <a  th:if="${name} == ${comment.NName}" th:href="@{/posts/comment/update(comment=${comment}, commNo = ${comment.commNo})}">댓글 수정</a>

        <form th:if="${name} == ${comment.NName}" th:action="@{/posts/comment/delete}" method="post" style="display:inline;">
            <input type="hidden" name="subno" th:value="${comment}"/> <!-- 댓글 ID를 전송 -->
            <button type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">댓글 삭제</button>
        </form> <!-- POST 방식으로 삭제 -->
    </div>
    <p th:text="${comment.content}">댓글 내용</p>

</div >
<div th:if="${isUser}">
<a class="button"  th:href="@{/posts/comment/create(commType='type1')}">댓글 생성</a>
</div>
<div>
    <a th:if="${name} == ${post.author}" th:href="@{/posts/update(post=${post})}" class="button">글 수정</a>

    <form th:if="${name} == ${post.author}" th:action="@{/posts/delete}" method="post" style="display:inline;">
        <input type="hidden" name="postId" th:value="${post}"/> <!-- 포스트 ID를 전송 -->
        <button type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">글 삭제</button>
    </form> <!-- POST 방식으로 삭제 -->
</div>


</body>
</html>
