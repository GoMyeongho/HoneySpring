<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">게시글</title>
    <link rel="stylesheet" th:href="@{/css/gpt.css}">
</head>
<body class="container">

<script th:inline="javascript">
        const postUpdate = /*[[${updateSuccess}]]*/ 0; // 모델에서 상태 정보 가져오기
        if(postUpdate > 0){
            if (postUpdate === 1) alert('글이 수정 되었습니다.');
            else alert('글 수정에 실패하였습니다')
        }
        const commDelete = /*[[${deleteCommSuccess}]]*/ 0;
        if(commDelete > 0){
            if (commDelete===1) alert('댓글이 삭제 되었습니다.');
            else alert('댓글 삭제에 실패하였습니다')
        }
        const commUpdate = /*[[${updateCommSuccess}]]*/ 0;
        if(commUpdate > 0){
            if (commUpdate===1) alert('댓글이 수정 되었습니다.');
            else alert('댓글 수정에 실패하였습니다')
        }
        const commCreate = /*[[${createCommSuccess}]]*/ 0;
        if(commCreate > 0){
            if (commCreate===1) alert('댓글이 생성 되었습니다.');
            else alert('댓글 생성에 실패하였습니다')
        }
        const like = /*[[${likeSuccess}]]*/ 0;
        if(like > 0){
            if (like===1) alert('좋아요가 수정 되었습니다.');
            else alert('좋아요 수정에 실패하였습니다')
        }
</script>

<div th:class="head">
    <a th:href="@{/posts/board}">
        <img th:src="@{/image/honey.png}" alt="메인" class="icon">
    </a>
    <span>
      <table th:class="mypage-table">
          <thead th:class="mypage-head">
          <tr th:class="mypage-name">
              <!-- isUser가 true일 때는 닉네임 표시, false일 때는 "로그인이 안되어 있습니다" 메시지 표시 -->
              <th th:if="${isUser}" th:text="'닉네임 : '+${user.NName}"></th>
              <th th:unless="${isUser}" class="no-login">로그인이 안되어 있습니다</th>
          </tr>
          </thead>
          <tbody>
          <tr th:class="mypage-select">
              <!-- isUser가 true일 때 마이페이지와 내정보수정 링크 표시 -->
              <td th:if="${isUser}" th:class="mypage-select">
                  <a th:class="button" th:href="@{/users/myPage}">마이페이지</a>
                  <a th:class="button" th:href="@{/users/login}">로그아웃</a>
              </td>
              <!-- isUser가 false일 때 로그인과 회원가입 링크 표시 -->
              <td th:unless="${isUser}" th:class="mypage-select">
                  <a th:class="button" th:href="@{/users/login}">로그인하기</a>
                  <a th:class="button" th:href="@{/login/signUp}">회원가입</a>
              </td>
          </tr>
          </tbody>
      </table>
    </span>
</div>
    <div>
        <div th:each="category : ${categories}" style="display: inline-block; margin-right: 10px;">
            <a th:href="@{/posts/board(value=${category}, type='type3')}" class="button-big">
                <span th:text="${category}"></span>
            </a>
        </div>
    </div>

<table class="post">
    <thead>
    <tr>
        <th colspan="2" class="post-header">
            <span class="postTitle" th:text="${post.title}">게시글 제목</span>
            <span class="category" th:text="' [' + ${post.category} + ']'">[카테고리]</span>
            <span class="author" th:text="'[작성자: ' + ${post.author} + ']'">작성자</span>
            <span class="date" th:text="${#dates.format(post.date, 'yyyy년 MM월 dd일')}">작성일</span>
        </th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td colspan="2" class="content" th:text="${post.content}">게시글 내용</td>
    </tr>
    <tr>
        <td class="like-section">
            <form th:if="${isUser}" th:action="@{/posts/view(postno=${post.postno})}" method="post">
                <button type="submit" th:class="icon-button">
                    <img th:src="${likeMark == '♥' ? '/image/filledHeart.png' : '/image/emptyHeart.png'}" alt="좋아요 버튼" />
                </button>
            </form>
            <img th:unless="${isUser}" style="width: 40px; height: 40px;"
                 th:src="@{/image/filledHeart.png}"alt="좋아요 버튼" >
            <span th:text="${likeNo}">좋아요 개수</span>
        </td>

    </tr>
    </tbody>
</table>

<div class="comments" th:each="comment : ${cList}">
    <h3>
        <span th:text="${comment.NName} ">작성자 </span>
        <span th:text="${#dates.format(comment.CDate, 'yyyy년 MM월 dd일')}">작성일</span>
    </h3>
    <p th:text="${comment.content}">댓글 내용</p>
    <div th:if="${isUser}">
        <div style="display: inline-block; margin-right: 10px;">
        <a  class="button"  th:href="@{/posts/comment/create(commType='type2', postno =${post.postno}, commNo=${comment.commNo})}">대댓글</a>
        </div>
        <div style="display: inline-block; margin-right: 10px;">
        <a  class="button"  th:if="${name} == ${comment.NName}" th:href="@{/posts/comment/update(subNo = ${comment.subNo})}">댓글 수정</a>
        </div>
        <div style="display: inline-block; margin-right: 10px;">
        <form th:if="${name} == ${comment.NName}" th:action="@{/posts/comment/delete}" method="post" style="display:inline;">
            <input type="hidden" name="subNo" th:value="${comment.subNo}"/> <!-- 댓글 ID를 전송 -->
            <button  class="button"  type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">댓글 삭제</button>
        </form> <!-- POST 방식으로 삭제 -->
        </div>
    </div>
</div >
<div class="post-actions" th:if="${isUser}">
    <a class="button" th:href="@{/posts/comment/create(commType='type1', postno=${post.postno})}">댓글 생성</a>
</div>

<div class="post-actions" style="margin-top: 10px;">
    <a th:if="${name} == ${post.author}" th:href="@{/posts/update(postno=${post.postno})}" class="button">글 수정</a>

    <form th:if="${name} == ${post.author}" th:action="@{/posts/delete}" method="post" style="display:inline;">
        <input type="hidden" name="postno" th:value="${post.postno}"/> <!-- 포스트 ID를 전송 -->
        <button class="button" type="submit" onclick="return confirm('정말 삭제하시겠습니까?');">글 삭제</button>
    </form> <!-- POST 방식으로 삭제 -->
</div>



</body>
</html>
